{"version":3,"file":"static/js/947.9997b3aa.chunk.js","mappings":"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","sources":["pages/Account/history.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport api from '../api';\r\nimport Loading from '../../loading';\r\nimport { getFromDB, saveToDB } from '../../db'; // Ensure this file has getFromDB & saveToDB functions\r\n\r\nconst History = () => {\r\n  const user = localStorage.getItem(\"user\");\r\n  const [data, setData] = useState([]);\r\n  const [load, setLoad] = useState(true);\r\n\r\n  useEffect(() => {\r\n    getCachedHistory();\r\n  }, []);\r\n\r\n  const getCachedHistory = async () => {\r\n    const cached = await getFromDB(`history_${user}`);\r\n    if (cached && !isExpired(cached.timestamp)) {\r\n      setData(cached.data);\r\n      setLoad(false);\r\n      console.log(\"Loaded history from IndexedDB\");\r\n    } else {\r\n      Hist();\r\n    }\r\n  };\r\n\r\n  const isExpired = (timestamp) => {\r\n    const now = Date.now();\r\n    const oneMinute = 1000 * 60 * 5;\r\n    return now - timestamp > oneMinute;\r\n  };\r\n\r\n  const Hist = () => {\r\n    try {\r\n      setTimeout(() => {\r\n        api.get(`${\"http://kalanirdhari.in\"}/update/data/${user}`)\r\n          .then(res => {\r\n            if (res.data.data) {\r\n              setData(res.data.data);\r\n              saveToDB(`history_${user}`, {\r\n                data: res.data.data,\r\n                timestamp: Date.now(),\r\n              });\r\n              setLoad(false);\r\n            } else if (res.data.Logout === \"OUT\") {\r\n              localStorage.removeItem(\"ssid\");\r\n              setLoad(false);\r\n              window.location.reload();\r\n            } else {\r\n              setLoad(false);\r\n              console.warn(\"Unexpected response structure:\", res.data);\r\n            }\r\n          })\r\n          .catch(error => {\r\n            setLoad(false);\r\n            if (error.response) {\r\n              console.error(\"API Error:\", error.response.status, error.response.data);\r\n            } else if (error.request) {\r\n              console.error(\"No response from server. Please check your connection.\");\r\n            } else {\r\n              console.error(\"Error occurred:\", error.message);\r\n            }\r\n          });\r\n      }, 1000);\r\n    } catch (error) {\r\n      setLoad(false);\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    \r\n    <div className='history_account_body'>\r\n      {load ? <Loading /> :\r\n        <center>\r\n          {/* <div className='Home-cnt-01-sub-01'>\r\n            <strong style={{color : 'white'}}>sta<span>W</span>ro</strong>\r\n            <hr />\r\n          </div> */}\r\n\r\n          <div>\r\n            \r\n          </div>\r\n          \r\n          <div className='account-subb-part-01'>\r\n            <h1>Transaction <span>History</span></h1>\r\n          </div>\r\n          <div className='account_histor-page-main-cnt-01'>\r\n            {/* {data.map((user, i) => (\r\n              <div key={i} className='account_histor-page-main-cnt-01-sub-cnt-01'>\r\n                {user.type === \"Credited\" && <span className='account_histor-page-main-cnt-01-sub-cnt-01-span-01'>\r\n                  {user.type} \"<strong> {user.tp === \"Rupee\" && <span>₹</span>} {user.rupee} {user.tp === \"Stars\" && <span>Stars</span>} </strong>\" to your Account</span>}\r\n                {user.type === \"Debited\" && <span className='account_histor-page-main-cnt-01-sub-cnt-01-span-01'>\r\n                  {user.type} \"<strong style={{ color: \"red\" }}>{user.tp === \"Rupee\" && <span>₹</span>} {user.rupee} {user.tp === \"Stars\" && <span>Stars</span>}</strong>\" from your Account</span>}\r\n              </div>\r\n            ))} */}\r\n\r\n            {data.map((user, i) => (\r\n              <div key={i} className='account_histor-page-main-cnt-01-sub-cnt-01_01'>\r\n                <div className='account_histor-page-main-cnt-01-sub-cnt-01_01_sub_div' style={{textAlign : 'start'}}>\r\n                  <h1>\r\n                    {user.type === \"Debited\" && (user.tp === \"Rupee\" ? \"Amount Debited\" : \"Stars Debited\")}\r\n                    {user.type === \"Credited\" && (user.tp === \"Rupee\" ? \"Amount Credited\" : \"Stars Credited\")}\r\n                  </h1>\r\n                  <span className='account_histor-page-main-cnt-01-sub-cnt-01_01_sub_div_span'>{user.Time}</span>\r\n\r\n                </div>\r\n                <div className='account_histor-page-main-cnt-01-sub-cnt-01_01_sub_div'>\r\n                  <h1>\r\n                    {user.type === \"Debited\" && <span className='account_histor-page-main-cnt-01-sub-cnt-01_01_sub_div_deb'>{user.tp === \"Rupee\" && <span>+ ₹</span>} {user.rupee} {user.tp === \"Stars\" && <span>Stars</span>}</span> }\r\n                    {user.type === \"Credited\" && <span className='account_histor-page-main-cnt-01-sub-cnt-01_01_sub_div_cred'>+ ₹{user.rupee}</span> }\r\n                  </h1>\r\n                </div>\r\n\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div style={{ height: \"50px\" }}></div>\r\n        </center>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default History;"],"names":["History","user","localStorage","getItem","data","setData","useState","load","setLoad","useEffect","getCachedHistory","async","cached","getFromDB","isExpired","timestamp","console","log","Hist","Date","now","setTimeout","api","get","then","res","saveToDB","Logout","removeItem","window","location","reload","warn","catch","error","response","status","request","message","_jsx","className","children","Loading","_jsxs","map","i","style","textAlign","type","tp","Time","rupee","height"],"sourceRoot":""}