{"version":3,"file":"static/js/393.d40f65d8.chunk.js","mappings":"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","sources":["pages/cupons.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport Loading from '../loading';\r\nimport { getFromDB, saveToDB } from '../db';\r\n\r\nconst Cupons = () => {\r\n  const [cuponData, setCuponData] = useState([]);\r\n  const [userData, setUserData] = useState([]);\r\n  const [load, setLoad] = useState(true);\r\n\r\n  // â±ï¸ Check if cache is expired\r\n  const isExpired = (timestamp) => {\r\n    return (Date.now() - timestamp) > 60000; // 1 minute\r\n  };\r\n\r\n  // ðŸŒ Fetch Cupons from API\r\n  const GetCupon = () => {\r\n    try {\r\n      setTimeout(() => {\r\n        fetch(`http://192.168.31.133/get/cupon/get/all/datas`)\r\n          .then(res => res.json())\r\n          .then(data => {\r\n            if (data.data) {\r\n              saveToDB(\"cupons_data\", { data: data.data, timestamp: Date.now() });\r\n              setCuponData(data.data);\r\n              setLoad(false);\r\n            } else {\r\n              setLoad(false);\r\n              console.warn(\"Unexpected response structure:\", data);\r\n            }\r\n          })\r\n          .catch(error => {\r\n            setLoad(false);\r\n            console.error(\"Fetch error:\", error);\r\n          });\r\n      }, 5000);\r\n    } catch (error) {\r\n      setLoad(false);\r\n      console.error(\"Unexpected error:\", error);\r\n    }\r\n  };\r\n\r\n  // ðŸ“¦ Load cached Cupons or fetch fresh\r\n  useEffect(() => {\r\n    const getCached = async () => {\r\n      const cached = await getFromDB(\"cupons_data\");\r\n\r\n      if (cached && !isExpired(cached.timestamp)) {\r\n        setCuponData(cached.data);\r\n        setLoad(false);\r\n        console.log(\"Loaded from IndexedDB\");\r\n      } else {\r\n        GetCupon();\r\n      }\r\n    };\r\n\r\n    getCached();\r\n\r\n    const interval = setInterval(() => {\r\n      console.log(\"Refreshing coupon data...\");\r\n      getCached();\r\n    }, 60000); // every 1 minute\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // ðŸ§‘â€ðŸ¤â€ðŸ§‘ Fetch user names after cuponData is loaded\r\n  useEffect(() => {\r\n    if (cuponData.length === 0) return;\r\n\r\n    const loadUsernames = async () => {\r\n      const cache = await getFromDB(\"cupon_name_cnt\");\r\n\r\n      if (cache && Array.isArray(cache)) {\r\n        setUserData(cache);\r\n        console.log(\"Loaded usernames from DB\");\r\n      } else {\r\n        const userList = [];\r\n\r\n        for (let i = 0; i < cuponData.length; i++) {\r\n          try {\r\n            const res = await fetch(`http://192.168.31.133/get/singel/user/won/data/${i + 1}`);\r\n            const json = await res.json();\r\n\r\n            if (json.data) {\r\n              const entry = { id: i, ...json.data };\r\n              userList.push(entry);\r\n            }\r\n          } catch (error) {\r\n            console.warn(\"User fetch failed for index\", i, error);\r\n          }\r\n        }\r\n\r\n        setUserData(userList);\r\n        saveToDB(\"cupon_name_cnt\", userList);\r\n      }\r\n    };\r\n\r\n    loadUsernames();\r\n  }, [cuponData]);\r\n\r\n  // ðŸ–¼ï¸ UI\r\n  return (\r\n    <div>\r\n      {load ? (\r\n        <Loading />\r\n      ) : (\r\n        <center>\r\n          <div className='Home-cnt-01-sub-01'>\r\n            <strong>sta<span>W</span>ro</strong>\r\n            <hr />\r\n          </div>\r\n\r\n          <div className='cupons_h1-01'>\r\n            <h1>Cupons</h1>\r\n          </div>\r\n\r\n          <div className=\"cart-page-main-cnt-02-sub-cnt-01\">\r\n            {cuponData.map((data, index) => {\r\n              const fetched = userData.find(user => user.id === index);\r\n\r\n              return (\r\n                <div key={index} className='cart_new_sub_cnt-01'>\r\n                  <strong>{data.title}</strong>\r\n                  <div className='cart_page_rank_cnt-01'>\r\n                    <span>Rank : {index + 1}</span>\r\n                  </div>\r\n                  <div className='cart_new_sub_cnt-01-img-cnt-01'>\r\n                    <img src={data.img} alt=\"Cupon\" />\r\n                  </div>\r\n                  <span className='cart_new_sub_cnt-01-span-01'>{data.body}</span>\r\n\r\n                  {fetched && (\r\n                    <div className='cart_new_sub_cnt-01-span-01-span-02'>\r\n                      <div className='cart_new_sub_cnt-01-span-01-span-02-top'>\r\n                        <strong>claimed</strong>\r\n                      </div>\r\n                      <span>{fetched.username}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </center>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Cupons;\r\n"],"names":["Cupons","cuponData","setCuponData","useState","userData","setUserData","load","setLoad","useEffect","getCached","async","cached","getFromDB","timestamp","Date","now","GetCupon","setTimeout","fetch","then","res","json","data","saveToDB","console","warn","catch","error","log","interval","setInterval","clearInterval","length","cache","Array","isArray","userList","i","entry","id","push","loadUsernames","_jsx","children","Loading","_jsxs","className","map","index","fetched","find","user","title","src","img","alt","body","username"],"sourceRoot":""}